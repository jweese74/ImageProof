{% extends "base.html" %}

{% block title %}Flagged & Disputed Images - ImageProof{% endblock %}

{% block csrf_token %}
    {{ csrf_token() }}
{% endblock %}

{% block content %}
{% if current_user.is_authenticated and current_user.role == 'Admin' %}
<section class="flagged-list section">
    <header>
        <h1>Flagged &amp; Disputed Images</h1>
    </header>

    <!-- Flash messages -->
    {% with messages = get_flashed_messages(with_categories=True) %}
        {% if messages %}
            {% for category, message in messages %}
                <div class="alert {{ category }}" role="alert">{{ message }}</div>
            {% endfor %}
        {% endif %}
    {% endwith %}

    <!-- Filters -->
    <div class="card" style="margin-bottom:1rem;">
        <form method="get" action="" class="filters" role="search">
            <div class="form-group">
                <label for="status_filter">Status</label>
                <select id="status_filter" name="status" class="select">
                    <option value="">All</option>
                    <option value="Disputed">Disputed</option>
                    <option value="Pending Review">Pending Review</option>
                    <option value="Resolved">Resolved</option>
                </select>
            </div>
            <div class="form-group">
                <label for="search">Search</label>
                <input id="search" name="q" type="text" class="input" placeholder="Hash or email">
            </div>
            <button type="submit" class="btn">Filter</button>
        </form>
    </div>

    <!-- Flagged Records Table -->
    <table class="table">
        <thead>
            <tr>
                <th scope="col">Flag ID</th>
                <th scope="col">Image</th>
                <th scope="col">Reported By</th>
                <th scope="col">Status</th>
                <th scope="col">Action</th>
            </tr>
        </thead>
        <tbody>
            {% for record in flagged_records %}
            <tr>
                <td>{{ record.id }}</td>
                <td>{{ record.image_hash[:12] }}&hellip;</td>
                <td>{{ record.reporter | e }}</td>
                <td><span class="status {{ record.status | lower | replace(' ', '-') }}">{{ record.status }}</span></td>
                <td><a href="{{ url_for('admin.flagged_detail', flag_id=record.id) }}" class="btn">View Details</a></td>
            </tr>
            {% else %}
            <tr>
                <td colspan="5" class="text-muted">No flagged records found.</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</section>
{% else %}
<p>You do not have access to this page.</p>
{% endif %}
{% endblock %}

{% block scripts %}
{{ super() }}
{% endblock %}